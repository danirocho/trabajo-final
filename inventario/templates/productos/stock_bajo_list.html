{% extends 'productos/base.html' %}
{% load bootstrap4 %}

{% block title %}Productos - Stock Bajo{% endblock %}
{% block header %}Productos - Stock Bajo{% endblock %}

{% block extra_buttons %}
<div>
		<a href="{% url 'productos:producto_list' %}" class="btn btn-secondary mr-2">
				<i class="fas fa-arrow-left"></i> Volver al listado
		</a>
		<a href="{% url 'productos:producto_create' %}" class="btn btn-primary">
				<i class="fas fa-plus"></i> Nuevo Producto
		</a>
</div>
{% endblock %}

{% block content %}
<p class="mb-3">Listado de productos cuyo stock está por debajo del mínimo.</p>

{% if productos %}
<div class="table-responsive">
		<table class="table table-striped table-hover">
				<thead class="thead-dark">
						<tr>
								<th>Imagen</th>
								<th>Nombre</th>
								<th>SKU</th>
								<th>Precio</th>
								<th>Stock</th>
								<th>Mínimo</th>
								<th>Estado</th>
								<th>Acciones</th>
						</tr>
				</thead>
				<tbody>
						{% for producto in productos %}
						<tr class="{% if producto.necesita_reposicion %}table-warning{% endif %}">
								<td>
										{% if producto.imagen %}
												<img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" class="product-img rounded">
										{% else %}
												<div class="product-img bg-light d-flex align-items-center justify-content-center rounded">
														<i class="fas fa-image text-muted"></i>
												</div>
										{% endif %}
								</td>
								<td>{{ producto.nombre }}</td>
								<td><code>{{ producto.sku }}</code></td>
								<td>${{ producto.precio }}</td>
								<td>
										{{ producto.stock }}
										{% if producto.necesita_reposicion %}
												<i class="fas fa-exclamation-circle text-danger ml-1"></i>
										{% endif %}
								</td>
								<td>{{ producto.stock_minimo }}</td>
								<td>
										{% if producto.necesita_reposicion %}
												<span class="badge badge-warning badge-lg">Bajo</span>
										{% else %}
												<span class="badge badge-success badge-lg">OK</span>
										{% endif %}
								</td>
								<td>
										<div class="btn-group btn-group-sm">
												<a href="{% url 'productos:producto_detail' producto.pk %}" class="btn btn-info" title="Ver detalle">
														<i class="fas fa-eye"></i>
												</a>
												<a href="{% url 'productos:producto_update' producto.pk %}" class="btn btn-primary" title="Editar">
														<i class="fas fa-edit"></i>
												</a>
												<a href="{% url 'productos:movimiento_create' producto.pk %}" class="btn btn-success" title="Movimiento">
														<i class="fas fa-exchange-alt"></i>
												</a>
										</div>
								</td>
						</tr>
						{% endfor %}
				</tbody>
		</table>
</div>
{% else %}
<div class="alert alert-info">
		<i class="fas fa-info-circle"></i> No hay productos con stock bajo.
</div>
{% endif %}

{% if is_paginated %}
	<nav aria-label="Page navigation">
		<ul class="pagination justify-content-center">
			{% if page_obj.has_previous %}
				<li class="page-item">
					<a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Anterior">
						<span aria-hidden="true">&laquo;</span>
					</a>
				</li>
			{% else %}
				<li class="page-item disabled"><span class="page-link">&laquo;</span></li>
			{% endif %}

			{% for num in paginator.page_range %}
				{% if page_obj.number == num %}
					<li class="page-item active"><span class="page-link">{{ num }}</span></li>
				{% elif num > page_obj.number|add:'-5' and num < page_obj.number|add:'5' %}
					<li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
				{% endif %}
			{% endfor %}

			{% if page_obj.has_next %}
				<li class="page-item">
					<a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Siguiente">
						<span aria-hidden="true">&raquo;</span>
					</a>
				</li>
			{% else %}
				<li class="page-item disabled"><span class="page-link">&raquo;</span></li>
			{% endif %}
		</ul>
	</nav>
{% endif %}

{% endblock %}
